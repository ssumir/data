<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CSV Integration</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">
  <div class="max-w-2xl mx-auto mt-10 p-6 bg-white rounded-lg shadow-lg">
    <h1 class="text-2xl font-bold text-center text-gray-800">Significant Data Holder</h1>

    <!-- Password Section -->
    <div id="passwordDiv" class="flex flex-col gap-4 mt-6">
      <input type="password" id="entryPassword" placeholder="Enter Password to Access Data" class="p-3 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
      <button id="checkPassword" class="p-3 bg-blue-500 text-white font-semibold rounded-md hover:bg-blue-600">
        Check Password
      </button>
    </div>

    <!-- Data Container -->
    <div id="dataContainer" class="hidden mt-6">
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-xl font-semibold text-gray-800">Data List</h2>
        <button id="exitButton" class="p-3 bg-red-500 text-white font-semibold rounded-md hover:bg-red-600">
          Exit
        </button>
      </div>
      <input type="text" id="filterInput" placeholder="Search..." class="p-3 w-full border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 mb-4">
      <ul id="contactList" class="list-none mt-4 space-y-4"></ul>
    </div>
  </div>

  <footer class="text-center mt-5 text-sm text-gray-500">
    Powered by Eng. Saiful Islam (Sumir).
  </footer>

  <script>
    const ACCESS_PASSWORD = "12345"; // Replace with your secure password
    const CSV_URL = "https://raw.githubusercontent.com/username/data/main/data.csv"; // Replace with your GitHub raw CSV file URL
    let contacts = [];
    const contactList = document.getElementById("contactList");
    const entryPasswordInput = document.getElementById("entryPassword");
    const checkPasswordBtn = document.getElementById("checkPassword");
    const passwordDiv = document.getElementById("passwordDiv");
    const dataContainer = document.getElementById("dataContainer");
    const filterInput = document.getElementById("filterInput");
    const exitButton = document.getElementById("exitButton");

    function displayContacts(filteredContacts = contacts) {
      contactList.innerHTML = "";
      filteredContacts.forEach((contact) => {
        const li = document.createElement("li");
        li.className = "p-4 bg-gray-200 rounded-lg shadow-sm";
        li.innerHTML = `
          <span class="block font-medium"><strong>Organization:</strong> ${contact.organization}</span>
          <span class="block"><strong>Web:</strong> ${contact.web}</span>
          <span class="block"><strong>User ID:</strong> ${contact.userId}</span>
          <span class="block"><strong>Password:</strong> ${contact.password}</span>
          <span class="block"><strong>Important:</strong> ${contact.important ? "Yes" : "No"}</span>
        `;
        contactList.appendChild(li);
      });
    }

    async function fetchCSV() {
      try {
        const response = await fetch(CSV_URL);
        if (!response.ok) {
          throw new Error("Failed to fetch CSV file.");
        }
        const csvData = await response.text();
        const rows = csvData.split("\n").slice(1); // Remove the header row
        rows.forEach((row) => {
          const [organization, web, userId, password, important] = row.split(",");
          if (organization && userId && password) {
            contacts.push({
              organization: organization.trim(),
              web: web?.trim() || "",
              userId: userId.trim(),
              password: password.trim(),
              important: important?.trim().toLowerCase() === "yes"
            });
          }
        });
        displayContacts();
      } catch (error) {
        console.error("Error fetching CSV:", error);
        alert("Failed to fetch CSV file. Please check the URL or network connection.");
      }
    }

    function checkPassword() {
      const enteredPassword = entryPasswordInput.value.trim();
      if (enteredPassword === ACCESS_PASSWORD) {
        passwordDiv.style.display = "none"; // Hide password section
        dataContainer.style.display = "block"; // Show data container
        fetchCSV(); // Fetch and display CSV data
        alert("Access granted!");
      } else {
        alert("Incorrect password. Please try again.");
      }
    }

    function filterContacts() {
      const query = filterInput.value.trim().toLowerCase();
      const filteredContacts = contacts.filter((contact) =>
        Object.entries(contact).some(([key, value]) =>
          key === "important"
            ? (contact.important ? "yes" : "no").includes(query)
            : value.toString().toLowerCase().includes(query)
        )
      );
      displayContacts(filteredContacts);
    }

    function exitDataContainer() {
      dataContainer.style.display = "none"; // Hide data container
      passwordDiv.style.display = "block"; // Show password input section
      entryPasswordInput.value = ""; // Clear password input
    }

    checkPasswordBtn.addEventListener("click", checkPassword);
    filterInput.addEventListener("input", filterContacts);
    exitButton.addEventListener("click", exitDataContainer);
  </script>
</body>
</html>
